<source>
  @type docker
  @log_level debug
  @id docker_input
  @docker_url tcp://docker:2375/
  @tag raw.docker.*
  @read_timeout 30
  @enable_ruby true
  @docker_container_logs_options '{"show_since": true, "tail": "all"}'
  <parse>
    @type json
  </parse>
</source>

<filter raw.docker.**>
  @type record_transformer
  <record>
    service_name ${tag_parts[2]}
    docker_id ${record["container_id"]}
  </record>
</filter>

<match raw.**>
  @type loki
  url "http://loki:3100/loki/api/v1/push"
  flush_interval 10s
  <buffer>
    flush_thread_count 4
    flush_interval 5s
  </buffer>
  <label>
    service_name ${service_name}
    container_id ${docker_id}
  </label>
</match>